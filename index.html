<!--

    <script type="text/javascript" charset="utf-8">
  (function (g, e, n, es, ys) {
    g['_genesysJs'] = e;
    g[e] = g[e] || function () {
      (g[e].q = g[e].q || []).push(arguments)
    };
    g[e].t = 1 * new Date();
    g[e].c = es;
    ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
  })(window, 'Genesys', 'https://apps.mypurecloud.de/genesys-bootstrap/genesys.min.js', {
    environment: 'euc1',
    // deploymentId: '6ed03b80-3430-4748-b7b7-c88ebad5450d' // US Talent
    // deploymentId: 'a3d1f2af-e2c2-48ad-8359-f37e5b46f423' // USI Workplace
    deploymentId: '07207da1-7826-4313-bfce-83da11dcdcf4' // USI Talent
  });
</script>
<script type="text/javascript" charset="utf-8">
    Genesys("command", "Database.set", { messaging: { customAttributes: { 
        Customer_Email: 'bajishaik@deloitte.com'
        // Customer_FirstName: 'CusFName',
        // Customer_LastName: 'CusLName'
    }}});
</script>
-->
<script type="text/javascript" charset="utf-8">
  (function (g, e, n, es, ys) {
    g['_genesysJs'] = e;
    g[e] = g[e] || function () {
      (g[e].q = g[e].q || []).push(arguments)
    };
    g[e].t = 1 * new Date();
    g[e].c = es;
    ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
  })(window, 'Genesys', 'https://apps.mypurecloud.de/genesys-bootstrap/genesys.min.js', {
    environment: 'euc1',
    deploymentId: '07207da1-7826-4313-bfce-83da11dcdcf4'
  });

  Genesys("command", "Database.set", { messaging: { customAttributes: { 
        Customer_Email: 'bajishaik@deloitte.com'
        // Customer_FirstName: 'CusFName',
        // Customer_LastName: 'CusLName'
    }}});

  </script>

<script type="text/javascript" charset="utf-8">
    Genesys("command", "Database.set", { messaging: { customAttributes: { cEmailAdd: 'bajishaik@deloitte.com' }}});
</script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Authenticated Web Messenger</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style>
        #myButton{
        float: center;
        margin-top: 25%;
        }
    </style>
	<script type="text/javascript" charset="utf-8">
            (function (g, e, n, es, ys) {
                g['_genesysJs'] = e;
                g[e] = g[e] || function () {
                (g[e].q = g[e].q || []).push(arguments)
                };
                g[e].t = 1 * new Date();
                g[e].c = es;
                ys = document.createElement('script'); ys.async = 1; ys.src = n; ys.charset = 'utf-8'; document.head.appendChild(ys);
            })(window, 'Genesys', 'https://apps.mypurecloud.de/genesys-bootstrap/genesys.min.js', {
                environment: 'euc1',
                deploymentId: '07207da1-7826-4313-bfce-83da11dcdcf4'
            });
    </script>
    <script>

    Genesys("subscribe","Auth.authenticated", function(o) {
        console.log('Authentication Successful');
        // bAuthenticated = true;
        // hideProgress();
        // LocalStorage usage is must for this product
        localStorage.setItem('authFetching', false);
    });

    if (localStorage.getItem('authFetching') == false || localStorage.getItem('authFetching') == "false" ) {
        console.log('Still authenticated');
    } else {
        console.log('just authenticated');
        authenticate();
    }

    function authenticate() {
        Genesys('registerPlugin', 'AuthProvider', (AuthProvider) => {

              // COMMAND
              // *********
              // getAuthCode

              const urlParams = new URLSearchParams(window.location.search); // Get the authorization response which is added as a query string from the redirect URL
              console.log(urlParams)
              if (urlParams.has('code')) {
				brandAuthCode = urlParams.get('code');
				}
			    else {
				const query = window.location.search.substring(1);
				const code = query.split('code=')[1];

				brandAuthCode = code && code.split('&')[0];
			  }
              // console.log("Auth Code is: ", brandAuthCode);
              
              /* Register Command - mandatory */
              
              AuthProvider.registerCommand('getAuthCode', (e) => {
                  
                  
                  alert("Brand Auth Code: " + brandAuthCode);
                
              //Messenger will call this command to get the tokens.
                  console.log('resolving');
                  e.resolve({
                      authCode: brandAuthCode,			// Pass your authCode here
                      redirectUri: "https://messenger.deloitte.com/",	// Pass the redirection URI configured in your Authentication provider here
                      deploymentId: '2276c658-1bbb-4cef-afe2-b2b767ae5647'
                    //   state: 12345,
                    //   scope: "https://graph.microsoft.com/.default"
                  });
              });
            //   AuthProvider.registerCommand('reAuthenticate', (e) => {
            //     //console.log('reauthenticating');

            //     // Messenger will call this command when current refreshToken and/or authCode are no more valid. Brand can add logic here to simply re-login and resolve this command after successful login so that Messenger can get the new authCode. (In case when browser needs to reload for a login, there is no need to resolve this command). Note: After a successful re-login, calling the getAuthCode command is taken care internally and there is no need to call it explicitly again.

            //     document.getElementById('myButton').click(); // simulate the login button click
            //     e.resolve();
			//   });
			  AuthProvider.subscribe('Auth.ready', () => {
					bAuthenticated = AuthProvider.data('Auth.authenticated');
                    console.log('auth ready');
					// toggleLogin();
			  });
			  AuthProvider.subscribe('Auth.authenticated', () => {
                    console.log('Authentication Successful');
					bAuthenticated = true;
					// hideProgress();
					// LocalStorage usage is must for this product
					// localStorage.setItem('authFetching', false);  // eslint-disable-line
					// toggleLogin();
			  });

              AuthProvider.ready();
        });
    }
    </script>
</head>
<body>
	<center>
		<button id="myButton" class="btn btn-secondary" >Click here to initiate a chat</button>
			<script language="JavaScript" type="text/javascript">
    			document.getElementById("myButton").onclick = function () {
//        			location.href = "https://login.microsoftonline.com/36da45f1-dd2c-4d1f-af13-5abe46b99921/oauth2/v2.0/authorize?client_id=10f32277-7880-4cb9-aa55-4d0c1e57250e&response_type=code&redirect_uri=https://messenger.deloitte.com/&response_mode=query&scope=openid%20email%20profile%20offline_access&state=12345";
    			};
			</script>
	</center>

</body>
</html>
